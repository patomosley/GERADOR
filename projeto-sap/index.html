<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" href="../favicon/pato.png" type="image/x-icon">
    <title>Sistema de Geração de Padrões para Chamados</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        body {
            font-family: Arial, sans-serif;
            line-height: 1.6;
            background-color: #f5f5f5;
            padding: 20px;
            color: #333;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        h1 {
            text-align: center;
            margin-bottom: 30px;
            color: #2c3e50;
        }
        .form-group {
            margin-bottom: 20px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #2c3e50;
        }
        input, select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
        }
        button {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            width: 100%;
            transition: background-color 0.3s;
        }
        button:hover {
            background-color: #2980b9;
        }
        .popup {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 100;
        }
        .popup-content {
            background: white;
            padding: 30px;
            border-radius: 10px;
            width: 80%;
            max-width: 800px;
            max-height: 80vh;
            overflow-y: auto;
        }
        .popup-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        .popup-header h2 {
            color: #2c3e50;
        }
        .close-btn {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            width: auto;
            padding: 0;
            color: #e74c3c;
        }
        .project-container {
            margin-bottom: 20px;
            padding: 15px;
            background: #f9f9f9;
            border-radius: 5px;
            border-left: 4px solid #3498db;
        }
        .project-label {
            font-weight: bold;
            margin-bottom: 5px;
            color: #2c3e50;
        }
        .project-value {
            word-break: break-word;
            padding: 10px;
            background: #fff;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .copy-btn {
            background-color: #2ecc71;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 10px;
            font-size: 14px;
            width: auto;
            display: inline-block;
        }
        .copy-btn:hover {
            background-color: #27ae60;
        }
        .notification {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 10px 20px;
            border-radius: 5px;
            color: white;
            font-weight: bold;
            z-index: 200;
            opacity: 0;
            transition: opacity 0.3s;
        }
        .notification.show {
            opacity: 1;
        }
        .success {
            background-color: #2ecc71;
        }
        .error {
            background-color: #e74c3c;
        }
        .child-projects-container {
            margin-top: 20px;
            border-top: 1px solid #ddd;
            padding-top: 20px;
        }
        .child-project-item {
            margin-bottom: 15px;
            padding: 15px;
            background: #f9f9f9;
            border-radius: 5px;
            border-left: 4px solid #e67e22;
        }
        .btn-secondary {
            background-color: #95a5a6;
            margin-right: 10px;
        }
        .btn-secondary:hover {
            background-color: #7f8c8d;
        }
        .child-config {
            margin-top: 20px;
            padding: 15px;
            background: #f8f8f8;
            border-radius: 5px;
            border: 1px solid #ddd;
        }
        .child-inputs {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }
        .child-inputs input, .child-inputs select {
            flex: 1;
        }
        .child-count {
            margin-bottom: 15px;
        }
        .copy-all-btn {
            background-color: #9b59b6;
            margin-top: 15px;
        }
        .copy-all-btn:hover {
            background-color: #8e44ad;
        }
        .flex-container {
            display: flex;
            gap: 10px;
        }
        .flex-container .form-group {
            flex: 1;
        }
        h3 {
            margin-bottom: 15px;
            color: #2c3e50;
        }
        .section-divider {
            margin: 30px 0 20px;
            border-top: 1px solid #ddd;
            padding-top: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Sistema de Geração de Padrões para Chamados</h1>
        <form id="form">
            <h3>Dados do Projeto Pai</h3>
            <div class="form-group">
                <label for="categoria">Categoria:</label>
                <select id="categoria" required>
                    <option value="">Selecionar opção</option>
                    <option value="GOVERNO">GOVERNO</option>
                    <option value="EMPRESA">EMPRESA</option>
                    <option value="PROVEDOR DE INTERNET">PROVEDOR DE INTERNET</option>
                    <option value="PROJETOS DA AGILITY">PROJETOS DA AGILITY</option>
                    <option value="PROJETO FUST">PROJETO FUST</option>
                    <option value="TARE-AL">TARE-AL</option>
                    <option value="TARE-PB">TARE-PB</option>
                    <option value="EVENTO">EVENTO</option>
                </select>
            </div>
            
            <div class="form-group">
                <label for="servico">Serviço:</label>
                <select id="servico" required>
                    <option value="">Selecionar opção</option>
                    <option value="REDE METRO ETHERNET">REDE METRO ETHERNET</option>
                    <option value="REDE DWDM">REDE DWDM</option>
                    <option value="REDES RÁDIOS">REDES RÁDIOS</option>
                    <option value="INTERNET COM ONU (GPON)">INTERNET COM ONU (GPON)</option>
                    <option value="INTERNET COM ONU (GPON) E CABO AS">INTERNET COM ONU (GPON) E CABO AS</option>
                    <option value="WIFI DE ALTA PERFORMANCE">WIFI DE ALTA PERFORMANCE</option>
                    <option value="LINK DEDICADO">LINK DEDICADO</option>
                    <option value="VIDEO MONITORAMENTO">VIDEO MONITORAMENTO</option>
                    <option value="SPEED">SPEED</option>
                    <option value="OCR">OCR</option>
                    <option value="TELEFONIA">TELEFONIA</option>
                </select>
            </div>
            
            <div class="form-group">
                <label for="cnpj">Número CNPJ:</label>
                <input type="text" id="cnpj" placeholder="XX.XXX.XXX/XXXX-XX" maxlength="18" required>
            </div>
            
            <div class="flex-container">
                <div class="form-group">
                    <label for="estado">Estado:</label>
                    <select id="estado" required>
                        <option value="">Selecionar opção</option>
                        <option value="CE">CE</option>
                        <!-- Adicionar mais estados conforme necessário -->
                    </select>
                </div>
            </div>
            
            <div class="form-group">
                <label for="empresa">Empresa:</label>
                <select id="empresa" required>
                    <option value="">Selecionar opção</option>
                    <option value="Brisanet">Brisanet</option>
                    <option value="American Tower Company">American Tower Company</option>
                    <option value="Brasil Tower Company">Brasil Tower Company</option>
                </select>
            </div>
            
            <div class="section-divider"></div>
            
            <div class="child-config">
                <h3>Configuração dos Projetos Filhos</h3>
                <div class="form-group child-count">
                    <label for="quantidadeFilhos">Quantidade de Projetos Filhos:</label>
                    <input type="number" id="quantidadeFilhos" min="1" value="1" required>
                </div>
                
                <div id="childProjectsConfig">
                    <!-- Campos para configuração dos projetos filhos serão gerados dinamicamente -->
                </div>
            </div>
            
            <button type="submit">Gerar Padrões</button>
        </form>
        
        <div id="notification" class="notification"></div>
    </div>
    
    <div id="popup" class="popup">
        <div class="popup-content">
            <div class="popup-header">
                <h2>Padrões Gerados</h2>
                <button id="closePopup" class="close-btn">&times;</button>
            </div>
            
            <div class="project-container">
                <div class="project-label">PROJETO PAI:</div>
                <div id="projetoPai" class="project-value"></div>
                <button id="copyProjetoPai" class="copy-btn">Copiar Projeto Pai</button>
            </div>
            
            <div class="child-projects-container" id="childProjectsContainer">
                <!-- Projetos filhos serão inseridos aqui -->
            </div>
            
            <button id="copyAllProjects" class="copy-btn copy-all-btn">Copiar Todos os Projetos</button>
        </div>
    </div>
    
    <script>
        // Função para exibir notificações
        function showNotification(message, type) {
            const notification = document.getElementById("notification");
            notification.textContent = message;
            notification.classList.add(type, "show");

            setTimeout(() => {
                notification.classList.remove("show");
                notification.classList.remove(type);
            }, 3000);
        }

        // Dicionários de estados, cidades e empresas
        const estadosCidades = {
            CE: {
                "Aquiraz": "AQZ",
                "ICO": "ICO",
                "PARAMBU": "PBU"
            }
            // Você pode adicionar mais estados e cidades conforme necessário
        };

        const categorias = {
            'GOVERNO': 'B2G',
            'EMPRESA': 'B2B',
            'PROVEDOR DE INTERNET': 'ISP',
            'PROJETOS DA AGILITY': 'AGL',
            'PROJETO FUST': 'FUST',
            'TARE-AL': 'TARE-AL',
            'TARE-PB': 'TARE-PB',
            'EVENTO': 'EVENTO'
        };

        const servicos = {
            'REDE METRO ETHERNET': 'MTR',
            'REDE DWDM': 'DWDM',
            'REDES RÁDIOS': 'WL-RÁDIO',
            'INTERNET COM ONU (GPON)': 'GPON',
            'INTERNET COM ONU (GPON) E CABO AS': 'GPONAS',
            'WIFI DE ALTA PERFORMANCE': 'WIFI',
            'LINK DEDICADO': 'LINK',
            'VIDEO MONITORAMENTO': 'CFTV',
            'SPEED': 'CFTV-SPD',
            'OCR': 'CFTV-OCR',
            'TELEFONIA': 'TEL'
        };

        const empresas = {
            'Brisanet': 'BRIT',
            'American Tower Company': 'AMT',
            'Brasil Tower Company': 'BTC',
        };

        // Função para formatar o CNPJ
        function formatarCNPJ(cnpj) {
            return cnpj.replace(/\D/g, '');
        }

        // Aplicar máscara ao CNPJ
        document.getElementById('cnpj').addEventListener('input', function() {
            let value = this.value.replace(/\D/g, '');
            if (value.length > 14) value = value.slice(0, 14);
            
            if (value.length > 12) {
                this.value = value.replace(/^(\d{2})(\d{3})(\d{3})(\d{4})(\d{2})$/, '$1.$2.$3/$4-$5');
            } else if (value.length > 8) {
                this.value = value.replace(/^(\d{2})(\d{3})(\d{3})(\d*)$/, '$1.$2.$3/$4');
            } else if (value.length > 5) {
                this.value = value.replace(/^(\d{2})(\d{3})(\d*)$/, '$1.$2.$3');
            } else if (value.length > 2) {
                this.value = value.replace(/^(\d{2})(\d*)$/, '$1.$2');
            } else {
                this.value = value;
            }
        });

        // Função para criar o seletor de cidades com base no estado
        function createCitySelector(stateValue, containerId) {
            const container = document.getElementById(containerId);
            const citySelect = document.createElement('select');
            citySelect.className = 'cidade-filho';
            citySelect.required = true;
            
            let optionDefault = document.createElement('option');
            optionDefault.value = '';
            optionDefault.textContent = 'Selecionar cidade';
            citySelect.appendChild(optionDefault);
            
            if (stateValue && estadosCidades[stateValue]) {
                const cidades = estadosCidades[stateValue];
                for (const cidade in cidades) {
                    const option = document.createElement('option');
                    option.value = cidades[cidade];
                    option.textContent = cidade;
                    citySelect.appendChild(option);
                }
            }
            
            return citySelect;
        }

        // Atualizar campos de configuração dos projetos filhos
        document.getElementById('quantidadeFilhos').addEventListener('change', function() {
            updateChildProjectsConfig();
        });

        function updateChildProjectsConfig() {
            const quantidade = parseInt(document.getElementById('quantidadeFilhos').value) || 1;
            const container = document.getElementById('childProjectsConfig');
            container.innerHTML = '';
            
            const estado = document.getElementById('estado').value;

            for (let i = 0; i < quantidade; i++) {
                const childDiv = document.createElement('div');
                childDiv.className = 'child-inputs';
                
                // Criar campos de entrada para contrato e ponto
                const contratoInput = document.createElement('input');
                contratoInput.type = 'text';
                contratoInput.id = `contratoFilho${i}`;
                contratoInput.placeholder = `Contrato do Filho ${i+1}`;
                contratoInput.required = true;
                
                const pontoInput = document.createElement('input');
                pontoInput.type = 'text';
                pontoInput.id = `pontoFilho${i}`;
                pontoInput.placeholder = `Ponto do Filho ${i+1}`;
                pontoInput.required = true;
                
                // Criar seletor de cidades para cada filho
                const cidadeDiv = document.createElement('div');
                cidadeDiv.id = `cidadeContainer${i}`;
                
                // Adicionar os elementos ao div do filho
                childDiv.appendChild(contratoInput);
                childDiv.appendChild(pontoInput);
                
                // Criar o seletor de cidades
                const citySelect = createCitySelector(estado, `cidadeContainer${i}`);
                citySelect.id = `cidadeFilho${i}`;
                childDiv.appendChild(citySelect);
                
                container.appendChild(childDiv);
            }
        }

        // Atualizar as cidades dos filhos quando o estado mudar
        document.getElementById('estado').addEventListener('change', function() {
            const estado = this.value;
            const quantidade = parseInt(document.getElementById('quantidadeFilhos').value) || 1;
            
            for (let i = 0; i < quantidade; i++) {
                const cidadeFilho = document.getElementById(`cidadeFilho${i}`);
                if (cidadeFilho) {
                    cidadeFilho.innerHTML = '<option value="">Selecionar cidade</option>';
                    
                    if (estado && estadosCidades[estado]) {
                        const cidades = estadosCidades[estado];
                        for (const cidade in cidades) {
                            const option = document.createElement('option');
                            option.value = cidades[cidade];
                            option.textContent = cidade;
                            cidadeFilho.appendChild(option);
                        }
                    }
                }
            }
        });

        // Inicializar a configuração dos projetos filhos
        updateChildProjectsConfig();

        // Evento de envio do formulário
        document.getElementById("form").addEventListener("submit", function(event) {
            event.preventDefault();

            const categoria = document.getElementById("categoria").value;
            const servico = document.getElementById("servico").value;
            const cnpj = document.getElementById("cnpj").value;
            const estado = document.getElementById("estado").value;
            const empresa = document.getElementById("empresa").value;
            const quantidadeFilhos = parseInt(document.getElementById("quantidadeFilhos").value) || 1;

            // Validar campos
            if (!categoria || !servico || !cnpj || !estado || !empresa) {
                showNotification("Por favor, preencha todos os campos obrigatórios.", "error");
                return;
            }

            // Verifica se a categoria é TARE-AL ou TARE-PB para excluir a UF do projeto pai
            let projetoPai = `${categorias[categoria]}-${servicos[servico]}-${formatarCNPJ(cnpj)}`;
            if (categoria !== "TARE-AL" && categoria !== "TARE-PB") {
                projetoPai += `-${estado}`;
            }
            projetoPai += `-${empresas[empresa]}`;

            document.getElementById("projetoPai").textContent = projetoPai;

            // Gerar projetos filhos
            const childProjectsContainer = document.getElementById("childProjectsContainer");
            childProjectsContainer.innerHTML = '';

            const allProjects = [projetoPai];

            for (let i = 0; i < quantidadeFilhos; i++) {
                const contratoFilho = document.getElementById(`contratoFilho${i}`).value;
                const pontoFilho = document.getElementById(`pontoFilho${i}`).value;
                const cidadeFilho = document.getElementById(`cidadeFilho${i}`).value;

                if (!contratoFilho || !pontoFilho || !cidadeFilho) {
                    showNotification(`Preencha todos os dados do Projeto Filho ${i+1}`, "error");
                    return;
                }

                const projetoFilho = `${categorias[categoria]}-${servicos[servico]}-${contratoFilho}-${pontoFilho}-${cidadeFilho}-${empresas[empresa]}`;
                allProjects.push(projetoFilho);

                const childDiv = document.createElement('div');
                childDiv.className = 'child-project-item';
                childDiv.innerHTML = `
                    <div class="project-label">PROJETO FILHO ${i+1}:</div>
                    <div class="project-value">${projetoFilho}</div>
                    <button class="copy-btn" onclick="copyChildProject(${i})">Copiar Projeto Filho ${i+1}</button>
                `;
                childProjectsContainer.appendChild(childDiv);
            }

            // Armazenar todos os projetos para cópia
            window.allProjectsText = allProjects.join('\n');

            document.getElementById("popup").style.display = "flex";
        });

        // Função para copiar projeto filho
        window.copyChildProject = function(index) {
            const childProjectValue = document.querySelectorAll('.child-project-item .project-value')[index].textContent;
            navigator.clipboard.writeText(childProjectValue).then(() => {
                showNotification(`Projeto Filho ${index+1} copiado com sucesso!`, "success");
            }).catch(() => {
                showNotification(`Erro ao copiar o Projeto Filho ${index+1}.`, "error");
            });
        };

        // Função para copiar o projeto pai
        document.getElementById("copyProjetoPai").addEventListener("click", function() {
            const projetoPai = document.getElementById("projetoPai").textContent;
            navigator.clipboard.writeText(projetoPai).then(() => {
                showNotification("Projeto Pai copiado com sucesso!", "success");
            }).catch(() => {
                showNotification("Erro ao copiar o Projeto Pai.", "error");
            });
        });

        // Função para copiar todos os projetos
        document.getElementById("copyAllProjects").addEventListener("click", function() {
            navigator.clipboard.writeText(window.allProjectsText).then(() => {
                showNotification("Todos os projetos copiados com sucesso!", "success");
            }).catch(() => {
                showNotification("Erro ao copiar todos os projetos.", "error");
            });
        });

        // Fechar o popup
        document.getElementById("closePopup").addEventListener("click", function() {
            document.getElementById("popup").style.display = "none";
        });

        // Fechar o popup com ESC
        document.addEventListener("keydown", function(event) {
            if (event.key === "Escape") {
                document.getElementById("popup").style.display = "none";
            }
        });
    </script>
</body>
</html>
